digraph madrasa_management_er {
    // Graph configuration
    rankdir=TB;
    node [shape=record, style=filled, fontname="Arial", fontsize=10];
    edge [color=darkblue, fontsize=9];
    
    // Main entity - Students
    students [
        label="{students|student_id (PK)\l|session\l|class\l|student_type (new/old)\l|gender (male/female)\l|residence_status (resident/non-resident)\l|name\l|father_name\l|mother_name\l|date_of_birth\l|nid_birth_no\l|nationality (default: Bangladeshi)\l|blood_group\l|guardian_phone\l|sms_number\l|created_at\l|updated_at\l}",
        fillcolor=yellow
    ];
    
    // Related entities
    addresses [
        label="{addresses|address_id (PK)\l|student_id (FK)\l|address_type (permanent/present)\l|village\l|post_office\l|thana\l|district\l|created_at\l|updated_at\l}",
        fillcolor=lightcyan
    ];
    
    fees [
        label="{fees|id (PK)\l|student_id (FK)\l|admit_form_fee (decimal 10,2)\l|id_card (decimal 10,2)\l|admission_fee (decimal 10,2)\l|created_at\l|updated_at\l}",
        fillcolor=lightcyan
    ];
    
    // Authentication & System tables
    users [
        label="{users|id (PK)\l|name\l|email (unique)\l|email_verified_at\l|password\l|remember_token\l|created_at\l|updated_at\l}",
        fillcolor=lightgreen
    ];
    
    // Primary relationships
    students -> addresses [label="1:N", color=red, penwidth=2];
    students -> fees [label="1:1", color=red, penwidth=2];
    
    // System relationships
    users -> users [label="Admin Access", style=dashed];
    
    // Grouping for better visualization
    subgraph cluster_main {
        label="Core Entities";
        style=filled;
        fillcolor=lightyellow;
        students;
        addresses;
        fees;
            subjects;
            class_subject;
            exams;
            results;
    }
    
    subgraph cluster_auth {
        label="Authentication";
        style=filled;
        fillcolor=lightgreen;
        users;
    }
    // New entities
    subjects [
        label="{subjects|id (PK)\l|name\l|code (unique)\l|type (theory/practical)\l|total_marks\l|pass_marks\l|is_active\l|created_at\l|updated_at\l}",
        fillcolor=lightgoldenrod
    ];

    class_subject [
        label="{class_subject|id (PK)\l|class (enum)\l|subject_id (FK)\l|is_active\l|created_at\l|updated_at\l}",
        fillcolor=lightgoldenrod1
    ];

    exams [
        label="{exams|id (PK)\l|name\l|class (enum)\l|session\l|exam_date\l|type (first_term/second_term/final)\l|status (scheduled/ongoing/completed/cancelled)\l|description\l|created_at\l|updated_at\l}",
        fillcolor=lightpink
    ];

    results [
        label="{results|id (PK)\l|student_id (FK)\l|exam_id (FK)\l|subject_id (FK)\l|obtained_marks\l|total_marks\l|percentage\l|status (pass/fail)\l|remarks\l|created_at\l|updated_at\l}",
        fillcolor=lightblue
    ];

    // New relationships
    students -> results [label="1:N", color=blue, penwidth=2];
    exams -> results [label="1:N", color=blue, penwidth=2];
    subjects -> results [label="1:N", color=blue, penwidth=2];
    
    // Many-to-Many: Subjects <-> Classes (through class_subject pivot)
    subjects -> class_subject [label="1:N", color=purple, penwidth=2, dir=both, arrowhead=crow, arrowtail=crow];
    // Note: class_subject.class is enum (play, nursery, first, etc.)
    // This creates M:N between subjects and class enum values
}
